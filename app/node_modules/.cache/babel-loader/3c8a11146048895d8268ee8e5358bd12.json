{"ast":null,"code":"import { ArithmeticError, MatrixError } from \"../errors\";\nimport { Computable, Numeric, isNumeric } from \".\";\nexport class UnevaluatedMatrix {\n  /**\n   * constructs a new matrix\n   * @param nodes optional: matrix as nodes if matrix unevaluated\n   * @param rows optional: matrix as numeric array if matrix evaluated\n   */\n  constructor(nodes) {\n    this.matrix = void 0;\n    this.dimR = void 0;\n    this.dimC = void 0;\n    // raw node matrix\n    this.matrix = nodes;\n    this.dimR = nodes.length;\n    this.dimC = this.dimR > 0 ? nodes[0].length : 0; // verify each row is the same length\n\n    for (let row of nodes) {\n      if (row.length != this.dimC) {\n        throw new MatrixError(\"row dimensions did not match\");\n      }\n    }\n  }\n  /**\n   * evaluates matrix from raw nodes\n   */\n\n\n  evaluate() {\n    let arr = new Array();\n\n    for (let row = 0; row < this.dimR; row++) {\n      arr.push([]);\n\n      for (let col = 0; col < this.dimC; col++) {\n        let val = this.matrix[row][col].eval();\n\n        if (isNumeric(val)) {\n          arr[row].push(val.value);\n        } else {\n          throw new SyntaxError(\"couldn't evaluate matrix! expected numbers.\");\n        }\n      }\n    }\n\n    return new Matrix(arr);\n  }\n\n  static isUnevaluatedMatrix(m) {\n    return m instanceof UnevaluatedMatrix;\n  }\n\n}\nexport class Matrix extends Computable {\n  /**\n   * constructs a new matrix\n   * @param nodes optional: matrix as nodes if matrix unevaluated\n   * @param rows optional: matrix as numeric array if matrix evaluated\n   */\n  constructor(rows) {\n    super();\n    this.matrix = void 0;\n    this.dimR = void 0;\n    this.dimC = void 0;\n    this.matrix = rows;\n    this.dimR = rows.length;\n    this.dimC = this.dimR > 0 ? rows[0].length : 0; // verify each row is the same length\n\n    for (let row of rows) {\n      if (row.length != this.dimC) {\n        throw new MatrixError(\"row dimensions did not match\");\n      }\n    }\n  }\n\n  checkDimensions(other) {\n    if (this.dimR != other.dimR || this.dimC != other.dimC) {\n      throw new MatrixError(`can't perform operations on matricies of different dimensions! (${this.dimR} x ${this.dimC}) and (${other.dimR} x ${other.dimC})`);\n    }\n  }\n\n  expectedMatrixError() {\n    throw new ArithmeticError(\"expected a matrix for calculations.\");\n  }\n\n  expectedMatrixOrNumericError() {\n    throw new ArithmeticError(\"expected a matrix or numeric for calculations.\");\n  }\n  /**\n   * add two matricies together by elementwise addition or add a constant to the matrix\n   * @param other a computable object\n   */\n\n\n  add(other) {\n    let arr = new Array();\n\n    if (isMatrix(other)) {\n      // add two matricies together\n      this.checkDimensions(other);\n\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(this.matrix[i][j] + other.matrix[i][j]);\n        }\n      }\n    } else if (isNumeric(other)) {\n      // add constant to each element\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(this.matrix[i][j] + other.value);\n        }\n      }\n    } else {\n      this.expectedMatrixOrNumericError();\n    }\n\n    return {\n      result: new Matrix(arr)\n    };\n  }\n  /**\n   * subtracts matrix from this, or subtracts constant from each element\n   * @param other any computable item\n   */\n\n\n  sub(other) {\n    let arr = new Array();\n\n    if (isMatrix(other)) {\n      // subtract two matricies together\n      this.checkDimensions(other);\n\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(this.matrix[i][j] - other.matrix[i][j]);\n        }\n      }\n    } else if (isNumeric(other)) {\n      // subtract constant to each element\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(this.matrix[i][j] - other.value);\n        }\n      }\n    } else {\n      this.expectedMatrixOrNumericError();\n    }\n\n    return {\n      result: new Matrix(arr)\n    };\n  }\n  /**\n   * element-wise multiplication\n   * @param other\n   */\n\n\n  el_mul(other) {\n    if (this.dimC == other.dimC && this.dimR == other.dimR) {\n      let arr = new Array();\n\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(this.matrix[i][j] * other.matrix[i][j]);\n        }\n      }\n\n      return {\n        result: new Matrix(arr)\n      };\n    } else {\n      throw new MatrixError(\"cannot do element-wise multiplication on different sized matricies\");\n    }\n  }\n  /**\n   * computes the matrix product or multiplies a matrix by a scalar\n   * @param other any computable item\n   */\n\n\n  mul(other) {\n    if (isMatrix(other)) {\n      // multiply two matricies\n      // check dimensions are proper\n      if (this.dimC != other.dimR) {\n        if (this.dimC == other.dimC && this.dimR == other.dimR) {\n          return {\n            result: this.mul(other.transpose().result).result,\n            message: \"inferred to take dot product.\"\n          };\n        }\n\n        throw new MatrixError(`can't multiply matricies of non-matching dimensions! (${this.dimR} x ${this.dimC}) and (${other.dimR} x ${other.dimC})`);\n      }\n\n      let newMatrix = new Array();\n\n      for (let i = 0; i < this.dimR; i++) {\n        newMatrix.push([]);\n\n        for (let j = 0; j < other.dimC; j++) {\n          let temp = 0;\n\n          for (let k = 0; k < this.dimC; k++) {\n            temp += this.matrix[i][k] * other.matrix[k][j];\n          }\n\n          newMatrix[i].push(temp);\n        }\n\n        if (newMatrix.length == 1 && newMatrix[0].length == 1) {\n          return {\n            result: new Numeric(newMatrix[0][0])\n          };\n        } else {\n          return {\n            result: new Matrix(newMatrix)\n          };\n        }\n      }\n    } else if (isNumeric(other)) {\n      let arr = new Array(); // multiply constant to each element\n\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(this.matrix[i][j] * other.value);\n        }\n      }\n\n      return {\n        result: new Matrix(arr)\n      };\n    }\n\n    this.expectedMatrixOrNumericError();\n  }\n  /**\n   * divide by a scalar, matrix division is not supported\n   * @param other\n   */\n\n\n  div(other) {\n    if (isNumeric(other)) {\n      let arr = new Array(); // multiply constant to each element\n\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(this.matrix[i][j] / other.value);\n        }\n      }\n\n      return {\n        result: new Matrix(arr)\n      };\n    }\n\n    this.expectedMatrixError();\n  }\n  /**\n   * divide by a scalar, matrix division is not supported\n   * @param other\n   */\n\n\n  rdiv(other) {\n    if (isNumeric(other)) {\n      let arr = new Array(); // multiply constant to each element\n\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(Math.floor(this.matrix[i][j] / other.value));\n        }\n      }\n\n      return {\n        result: new Matrix(arr)\n      };\n    }\n\n    this.expectedMatrixError();\n  }\n  /**\n   * take power\n   * @param other\n   */\n\n\n  pow(other) {\n    if (this.dimR != this.dimC) {\n      throw new MatrixError(\"only square matricies can be raised to the power\");\n    }\n\n    if (isNumeric(other)) {\n      let newMatrix = this;\n\n      for (let i = 0; i < other.value; i++) {\n        let tmp = newMatrix.mul(this).result;\n\n        if (isMatrix(tmp)) {\n          newMatrix = tmp;\n        } else {\n          throw new MatrixError(\"multiplication failed: \" + tmp);\n        }\n      }\n\n      return {\n        result: newMatrix\n      };\n    } else {\n      throw new MatrixError(\"matrix power is not supported\");\n    }\n  }\n\n  transpose(save = false) {\n    let arr = new Array();\n\n    for (let i = 0; i < this.dimC; i++) {\n      arr.push([]);\n\n      for (let j = 0; j < this.dimR; j++) {\n        arr[i].push(this.matrix[j][i]);\n      }\n    }\n\n    if (save) {\n      this.matrix = arr;\n      let tmp = this.dimR;\n      this.dimR = this.dimC;\n      this.dimC = tmp;\n      return {\n        result: this\n      };\n    }\n\n    return {\n      result: new Matrix(arr)\n    };\n  }\n\n  determinant() {\n    if (this.dimR != this.dimC) {\n      throw new MatrixError(\"cannot take determinant of non-square matrix\");\n    }\n\n    let n = this.dimR;\n    let M = this.matrix;\n\n    if (n == 2) {\n      return M[0][0] * M[1][1] - M[0][1] * M[1][0];\n    } else {\n      let d = 0;\n\n      for (let i = 0; i < n; i++) {\n        // create a sub matrix\n        let subMatrix = [];\n\n        for (let r = 0; r < n; r++) {\n          subMatrix.push([]);\n\n          for (let c = 0; c < n; c++) {\n            if (c != i) {\n              subMatrix[r].push(this.matrix[r][c]);\n            }\n          }\n        }\n\n        d += M[0][i] * new Matrix(subMatrix).determinant();\n      }\n\n      return d;\n    }\n  }\n\n  subMatrix(startRow, endRow = this.dimR - 1, startCol, endCol = this.dimC - 1) {\n    let arr = new Array();\n\n    for (let i = startRow; i <= endRow; i++) {\n      arr.push([]);\n\n      for (let j = startCol; j <= endCol; j++) {\n        arr[i].push(this.matrix[i][j]);\n      }\n    }\n\n    return new Matrix(arr);\n  }\n\n  toString() {\n    let m = this.matrix;\n    let str = \"\";\n\n    if (m.length == 1) {\n      str += \"< \";\n\n      for (let i = 0; i < this.dimC; i++) {\n        str += m[0][i];\n\n        if (i != m[0].length - 1) {\n          str += \" \";\n        }\n      }\n\n      str += \" >\";\n    } else {\n      str += \"[\";\n\n      for (let i = 0; i < this.dimR; i++) {\n        if (i != 0) {\n          str += \" \";\n        }\n\n        str += \"[ \";\n\n        for (let j = 0; j < this.dimC; j++) {\n          str += m[i][j] + \" \";\n        }\n\n        str += \"]\";\n\n        if (i != this.dimR - 1) {\n          str += \"\\n\";\n        }\n      }\n\n      str += \"]\";\n      str += `  { ${this.dimR} x ${this.dimC} }`;\n    }\n\n    return str;\n  }\n\n}\nexport function isMatrix(el) {\n  return el instanceof Matrix;\n}","map":{"version":3,"sources":["/Users/pranavputta/GitHub/linalg_lang/frontend/src/interpreter/computable/matrix.ts"],"names":["ArithmeticError","MatrixError","Computable","Numeric","isNumeric","UnevaluatedMatrix","constructor","nodes","matrix","dimR","dimC","length","row","evaluate","arr","Array","push","col","val","eval","value","SyntaxError","Matrix","isUnevaluatedMatrix","m","rows","checkDimensions","other","expectedMatrixError","expectedMatrixOrNumericError","add","isMatrix","i","j","result","sub","el_mul","mul","transpose","message","newMatrix","temp","k","div","rdiv","Math","floor","pow","tmp","save","determinant","n","M","d","subMatrix","r","c","startRow","endRow","startCol","endCol","toString","str","el"],"mappings":"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","sourcesContent":["import { ArithmeticError, MatrixError } from \"../errors\";\nimport { Computable, Result, Numeric, isNumeric } from \".\";\nimport { ComputableNode } from \"../ast\";\n\nexport interface MatrixResult extends Result {\n  result: Matrix;\n}\n\nexport class UnevaluatedMatrix {\n  private matrix: ComputableNode[][];\n  private dimR: number;\n  private dimC: number;\n  /**\n   * constructs a new matrix\n   * @param nodes optional: matrix as nodes if matrix unevaluated\n   * @param rows optional: matrix as numeric array if matrix evaluated\n   */\n  constructor(nodes: ComputableNode[][]) {\n    // raw node matrix\n    this.matrix = nodes;\n    this.dimR = nodes.length;\n    this.dimC = this.dimR > 0 ? nodes[0].length : 0;\n\n    // verify each row is the same length\n    for (let row of nodes) {\n      if (row.length != this.dimC) {\n        throw new MatrixError(\"row dimensions did not match\");\n      }\n    }\n  }\n\n  /**\n   * evaluates matrix from raw nodes\n   */\n  public evaluate(): Matrix {\n    let arr: number[][] = new Array();\n    for (let row = 0; row < this.dimR; row++) {\n      arr.push([]);\n      for (let col = 0; col < this.dimC; col++) {\n        let val = this.matrix[row][col].eval();\n        if (isNumeric(val)) {\n          arr[row].push(val.value);\n        } else {\n          throw new SyntaxError(\"couldn't evaluate matrix! expected numbers.\");\n        }\n      }\n    }\n    return new Matrix(arr);\n  }\n\n  public static isUnevaluatedMatrix(m: any): m is UnevaluatedMatrix {\n    return m instanceof UnevaluatedMatrix;\n  }\n}\n\nexport class Matrix extends Computable {\n  matrix: number[][];\n  dimR: number;\n  dimC: number;\n\n  /**\n   * constructs a new matrix\n   * @param nodes optional: matrix as nodes if matrix unevaluated\n   * @param rows optional: matrix as numeric array if matrix evaluated\n   */\n  constructor(rows: number[][]) {\n    super();\n\n    this.matrix = rows;\n    this.dimR = rows.length;\n    this.dimC = this.dimR > 0 ? rows[0].length : 0;\n\n    // verify each row is the same length\n    for (let row of rows) {\n      if (row.length != this.dimC) {\n        throw new MatrixError(\"row dimensions did not match\");\n      }\n    }\n  }\n\n  private checkDimensions(other: Matrix) {\n    if (this.dimR != other.dimR || this.dimC != other.dimC) {\n      throw new MatrixError(\n        `can't perform operations on matricies of different dimensions! (${this.dimR} x ${this.dimC}) and (${other.dimR} x ${other.dimC})`\n      );\n    }\n  }\n\n  private expectedMatrixError(): never {\n    throw new ArithmeticError(\"expected a matrix for calculations.\");\n  }\n\n  private expectedMatrixOrNumericError(): never {\n    throw new ArithmeticError(\"expected a matrix or numeric for calculations.\");\n  }\n\n  /**\n   * add two matricies together by elementwise addition or add a constant to the matrix\n   * @param other a computable object\n   */\n  public add(other: Computable): MatrixResult {\n    let arr: number[][] = new Array();\n    if (isMatrix(other)) {\n      // add two matricies together\n      this.checkDimensions(other);\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(this.matrix[i][j] + other.matrix[i][j]);\n        }\n      }\n    } else if (isNumeric(other)) {\n      // add constant to each element\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(this.matrix[i][j] + other.value);\n        }\n      }\n    } else {\n      this.expectedMatrixOrNumericError();\n    }\n\n    return { result: new Matrix(arr) };\n  }\n\n  /**\n   * subtracts matrix from this, or subtracts constant from each element\n   * @param other any computable item\n   */\n  public sub(other: Computable): MatrixResult {\n    let arr: number[][] = new Array();\n\n    if (isMatrix(other)) {\n      // subtract two matricies together\n      this.checkDimensions(other);\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(this.matrix[i][j] - other.matrix[i][j]);\n        }\n      }\n    } else if (isNumeric(other)) {\n      // subtract constant to each element\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(this.matrix[i][j] - other.value);\n        }\n      }\n    } else {\n      this.expectedMatrixOrNumericError();\n    }\n\n    return { result: new Matrix(arr) };\n  }\n\n  /**\n   * element-wise multiplication\n   * @param other\n   */\n  public el_mul(other: Matrix): MatrixResult {\n    if (this.dimC == other.dimC && this.dimR == other.dimR) {\n      let arr: number[][] = new Array();\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(this.matrix[i][j] * other.matrix[i][j]);\n        }\n      }\n      return { result: new Matrix(arr) };\n    } else {\n      throw new MatrixError(\n        \"cannot do element-wise multiplication on different sized matricies\"\n      );\n    }\n  }\n\n  /**\n   * computes the matrix product or multiplies a matrix by a scalar\n   * @param other any computable item\n   */\n  public mul(other: Computable): Result {\n    if (isMatrix(other)) {\n      // multiply two matricies\n      // check dimensions are proper\n      if (this.dimC != other.dimR) {\n        if (this.dimC == other.dimC && this.dimR == other.dimR) {\n          return {\n            result: this.mul(other.transpose().result).result,\n            message: \"inferred to take dot product.\",\n          };\n        }\n        throw new MatrixError(\n          `can't multiply matricies of non-matching dimensions! (${this.dimR} x ${this.dimC}) and (${other.dimR} x ${other.dimC})`\n        );\n      }\n      let newMatrix: number[][] = new Array();\n      for (let i = 0; i < this.dimR; i++) {\n        newMatrix.push([]);\n        for (let j = 0; j < other.dimC; j++) {\n          let temp = 0;\n          for (let k = 0; k < this.dimC; k++) {\n            temp += this.matrix[i][k] * other.matrix[k][j];\n          }\n          newMatrix[i].push(temp);\n        }\n\n        if (newMatrix.length == 1 && newMatrix[0].length == 1) {\n          return { result: new Numeric(newMatrix[0][0]) };\n        } else {\n          return { result: new Matrix(newMatrix) };\n        }\n      }\n    } else if (isNumeric(other)) {\n      let arr: number[][] = new Array();\n      // multiply constant to each element\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(this.matrix[i][j] * other.value);\n        }\n      }\n      return { result: new Matrix(arr) };\n    }\n    this.expectedMatrixOrNumericError();\n  }\n\n  /**\n   * divide by a scalar, matrix division is not supported\n   * @param other\n   */\n  public div(other: Computable): MatrixResult {\n    if (isNumeric(other)) {\n      let arr: number[][] = new Array();\n      // multiply constant to each element\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(this.matrix[i][j] / other.value);\n        }\n      }\n      return { result: new Matrix(arr) };\n    }\n    this.expectedMatrixError();\n  }\n\n  /**\n   * divide by a scalar, matrix division is not supported\n   * @param other\n   */\n  public rdiv(other: Computable): MatrixResult {\n    if (isNumeric(other)) {\n      let arr: number[][] = new Array();\n      // multiply constant to each element\n      for (let i = 0; i < this.dimR; i++) {\n        arr.push([]);\n        for (let j = 0; j < this.dimC; j++) {\n          arr[i].push(Math.floor(this.matrix[i][j] / other.value));\n        }\n      }\n      return { result: new Matrix(arr) };\n    }\n    this.expectedMatrixError();\n  }\n\n  /**\n   * take power\n   * @param other\n   */\n  public pow(other: Computable): MatrixResult {\n    if (this.dimR != this.dimC) {\n      throw new MatrixError(\"only square matricies can be raised to the power\");\n    }\n    if (isNumeric(other)) {\n      let newMatrix: Matrix = this;\n      for (let i = 0; i < other.value; i++) {\n        let tmp = newMatrix.mul(this).result;\n        if (isMatrix(tmp)) {\n          newMatrix = tmp;\n        } else {\n          throw new MatrixError(\"multiplication failed: \" + tmp);\n        }\n      }\n      return { result: newMatrix };\n    } else {\n      throw new MatrixError(\"matrix power is not supported\");\n    }\n  }\n\n  public transpose(save: boolean = false): MatrixResult {\n    let arr: number[][] = new Array();\n    for (let i = 0; i < this.dimC; i++) {\n      arr.push([]);\n      for (let j = 0; j < this.dimR; j++) {\n        arr[i].push(this.matrix[j][i]);\n      }\n    }\n\n    if (save) {\n      this.matrix = arr;\n      let tmp = this.dimR;\n      this.dimR = this.dimC;\n      this.dimC = tmp;\n      return { result: this };\n    }\n    return { result: new Matrix(arr) };\n  }\n\n  public determinant(): number {\n    if (this.dimR != this.dimC) {\n      throw new MatrixError(\"cannot take determinant of non-square matrix\");\n    }\n\n    let n = this.dimR;\n    let M = this.matrix;\n    if (n == 2) {\n      return M[0][0] * M[1][1] - M[0][1] * M[1][0];\n    } else {\n      let d = 0;\n      for (let i = 0; i < n; i++) {\n        // create a sub matrix\n        let subMatrix: number[][] = [];\n        for (let r = 0; r < n; r++) {\n          subMatrix.push([]);\n          for (let c = 0; c < n; c++) {\n            if (c != i) {\n              subMatrix[r].push(this.matrix[r][c]);\n            }\n          }\n        }\n\n        d += M[0][i] * new Matrix(subMatrix).determinant();\n      }\n      return d;\n    }\n  }\n\n  public subMatrix(\n    startRow: number,\n    endRow: number = this.dimR - 1,\n    startCol: number,\n    endCol: number = this.dimC - 1\n  ): Matrix {\n    let arr: number[][] = new Array();\n    for (let i = startRow; i <= endRow; i++) {\n      arr.push([]);\n      for (let j = startCol; j <= endCol; j++) {\n        arr[i].push(this.matrix[i][j]);\n      }\n    }\n    return new Matrix(arr);\n  }\n\n  public toString(): string {\n    let m = this.matrix;\n    let str = \"\";\n    if (m.length == 1) {\n      str += \"< \";\n      for (let i = 0; i < this.dimC; i++) {\n        str += m[0][i];\n        if (i != m[0].length - 1) {\n          str += \" \";\n        }\n      }\n      str += \" >\";\n    } else {\n      str += \"[\";\n      for (let i = 0; i < this.dimR; i++) {\n        if (i != 0) {\n          str += \" \";\n        }\n        str += \"[ \";\n        for (let j = 0; j < this.dimC; j++) {\n          str += m[i][j] + \" \";\n        }\n        str += \"]\";\n        if (i != this.dimR - 1) {\n          str += \"\\n\";\n        }\n      }\n      str += \"]\";\n      str += `  { ${this.dimR} x ${this.dimC} }`;\n    }\n\n    return str;\n  }\n}\n\nexport function isMatrix(el: any): el is Matrix {\n  return el instanceof Matrix;\n}\n"]},"metadata":{},"sourceType":"module"}